# Linux Study Room - Backend Integration Guide

**Frontend Developer**: User / Antigravity
**Date**: 2025-12-08
**Version**: Frontend v1.0 (Mockup Complete)

This document outlines the API endpoints, WebSocket protocols, and data structures required to integrate the Vue 3 frontend with the Go/Gin backend.

## 1. Authentication (`AuthModal.vue`)

The frontend implements a mandatory login flow with two modes: **GitHub OAuth** and **Guest Access**.

### 1.1 GitHub OAuth
*   **Frontend Action**: Redirects user window to backend auth URL or handles popup.
*   **Expected Endpoint**: `GET /api/auth/github`
*   **Callback**: `GET /api/auth/github/callback`
    *   Should set a secure HTTP-only cookie (e.g., `session_token`).
    *   Should redirect back to frontend (e.g., `/?token=xxx` or just sets cookie).
    *   **User Data**: Frontend expects to fetch user info via `GET /api/me`.

### 1.2 Guest Access
*   **Frontend Action**: User clicks "Enter as Guest".
*   **Logic**: Frontend currently generates a mock user `{ username: 'Guest_1337', provider: 'guest' }`.
*   **Backend Requirement**: If we want server-side guest sessions, we need `POST /api/auth/guest` that returns a temporary session token.

### 1.3 User Profile (`GET /api/me`)
After login, frontend needs to know who the current user is.
```json
{
  "id": "u_12345",
  "username": "Alex_Dev",
  "avatar": "https://...",
  "provider": "github" // or "guest"
}
```

## 2. Container Management (`Terminal.vue` & `AuthModal.vue`)

### 2.1 Initialization (Setup Wizard)
When a user finishes the "Setup Wizard" (OS Selection):
*   **Endpoint**: `POST /api/container/launch`
*   **Payload**:
    ```json
    {
      "os_type": "alpine" // or "debian"
    }
    ```
*   **Response**: `{ "container_id": "c_abc123", "status": "starting" }`

### 2.2 Lifecycle Actions (Toolbar)
*   **Restart**: `POST /api/container/{id}/restart`
*   **Destroy/Reset**: `POST /api/container/{id}/reset`
    *   Should wipe the rootfs but **keep the volume** (if that's the policy) OR wipe everything (if "Factory Reset").
    *   Current Frontend Logic: "Destroy" puts UI in 'Destroyed' state. "Start" triggers Setup Wizard again.

## 3. Terminal WebSocket (`Terminal.vue`)

*   **Endpoint**: `WS /ws/terminal` (or `/ws/terminal?container_id=...`)
*   **Protocol**:
    *   **Input (Client -> Server)**: Raw string characters (xterm input).
    *   **Output (Server -> Client)**: Raw string/ANSI codes.
*   **Resize**: Handle window resize events.
    *   Client sends: `{"type": "resize", "cols": 80, "rows": 24}` (Needs to be standardized, currently xterm handles raw data, but resizing usually needs a control message).
*   **Heartbeat**: Frontend assumes backend track activity via WS connection. **20 min idle rule** should be enforced by backend terminating the WS or sending a shutdown signal.

## 4. Live Wall & Chat (`LiveWall.vue`)

### 4.1 Real-time Session List
*   **Endpoint**: `WS /ws/lobby`
*   **Data (Server -> Client)**: Broadcast list of active users.
    ```json
    {
      "type": "users_update",
      "count": 4821,
      "sessions": [
        { "id": 1, "username": "Alex", "os": "alpine", "thumbnail": "..." },
        { "id": 2, "username": "Sarah", "os": "debian", "thumbnail": "..." }
      ]
    }
    ```

### 4.2 Chat
*   **Protocol**:
    *   **Send**: `{"type": "chat", "content": "Hello world"}`
    *   **Receive**: `{"type": "chat", "user": "Alex", "content": "Hello world", "timestamp": ...}`
*   **Permissions**: Backend **MUST** reject chat messages from Guest users (double check, frontend also blocks UI).

## 5. UI Assets & Theme

*   **Theme**: Deep Galaxy (Tailwind).
*   **Fonts**: JetBrains Mono (Terminal), Inter (UI).
*   **Icons**: SVG inline.

## 6. Next Steps for Backend Dev

1.  **Implement `/api/auth/github`**.
2.  **Set up k8s/Docker orchestration** for on-demand containers.
3.  **Implement WebSocket Hub** for Terminal streaming (pty integration).
4.  **Implement Logic Enforcement**: 20 min idle timer.

---
*Generated by Antigravity*
